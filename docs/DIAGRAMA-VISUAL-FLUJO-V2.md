# ğŸ“Š Diagrama Visual del Nuevo Flujo de AutorizaciÃ³n

## ğŸ”€ Comparativa: Antes vs DespuÃ©s

### âŒ ANTES (V1)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario entra a crear encuesta      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Modal ABIERTOâ”‚ â† AutomÃ¡tico, invasivo
        â”‚ (Forzado)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€ Usuario scrollea
               â”‚
               â”œâ”€ Puede marcar checkbox
               â”‚  en cualquier momento
               â”‚
               â””â”€ Aceptar y continuar
               
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Encuesta normal  â”‚
        â”‚ Etapas 1-6       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… AHORA (V2)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario entra a crear encuesta   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Etapas 1-5 Normalesâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ETAPA 6: Observaciones             â”‚
   â”‚                                    â”‚
   â”‚ â€¢ Campo 1: Sustento de familia     â”‚
   â”‚ â€¢ Campo 2: Observaciones           â”‚
   â”‚ â€¢ Campo 3: [AUTORIZACIÃ“N] â† NUEVO â”‚
   â”‚            - Checkbox: DESHABILITADO
   â”‚            - BotÃ³n: "Ver tÃ©rminos..." ğŸ”—
   â”‚            - Mensaje: âš ï¸ Debes leer
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
            Usuario
              hace
              click
                â”‚
                â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ MODAL DE TÃ‰RMINOS SE ABRE      â”‚
      â”‚                                â”‚
      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ â”‚ SecciÃ³n 1: Responsable       â”‚
      â”‚ â”‚ SecciÃ³n 2: Finalidad         â”‚
      â”‚ â”‚ SecciÃ³n 3: Datos             â”‚
      â”‚ â”‚ SecciÃ³n 4: LegitimaciÃ³n      â”‚
      â”‚ â”‚ SecciÃ³n 5: Seguridad         â”‚
      â”‚ â”‚ SecciÃ³n 6: Derechos          â”‚
      â”‚ â”‚ SecciÃ³n 7: DuraciÃ³n          â”‚
      â”‚ â”‚ SecciÃ³n 8: Contacto          â”‚
      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ Checkbox: BLOQUEADO ğŸ”’         â”‚
      â”‚ Alert: âš ï¸ Lee todo              â”‚
      â”‚ BotÃ³n: Gris (deshabilitado)   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
              Usuario
             scrollea
                   â”‚
          Â¿LlegÃ³ al fin?
                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
            â”‚             â”‚
           NO             YES
            â”‚             â”‚
            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    â”‚ Checkbox: HABILITADO âœ…
            â”‚    â”‚ Alert: âœ… TÃ©rminos...â”‚
            â”‚    â”‚ BotÃ³n: Verde ğŸŸ¢      â”‚
            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚             â”‚
            â”‚         Usuario
            â”‚         marca &
            â”‚         click
            â”‚             â”‚
            â–¼             â–¼
      Mensaje:     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      âš ï¸ Lee todo   â”‚ Modal cierra â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ ETAPA 6: Vuelve al formulario   â”‚
      â”‚                                 â”‚
      â”‚ â€¢ Checkbox: HABILITADO âœ…       â”‚
      â”‚ â€¢ Mensaje: âœ… TÃ©rminos...       â”‚
      â”‚ â€¢ Usuario marca checkbox        â”‚
      â”‚ â€¢ Completa resto de campos      â”‚
      â”‚ â€¢ Click "Guardar Encuesta"      â”‚
      â”‚                                 â”‚
      â”‚ âœ… ENCUESTA ENVIADA             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Estados del Checkbox

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPONENTE: DataProtectionCheckbox                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ ESTADO 1: Inicial (Antes de leer)                  â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ â˜‘ï¸  Checkbox: [disabled] âŒ                        â”‚
â”‚ ğŸ“„  BotÃ³n: "Ver tÃ©rminos..." (AZUL)                â”‚
â”‚ âš ï¸  Mensaje: "Debes leer y aceptar"               â”‚
â”‚                                                     â”‚
â”‚ ESTADO 2: Leyendo en Modal                         â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ â˜‘ï¸  Checkbox del modal: [disabled] ğŸ”’              â”‚
â”‚ â¬‡ï¸  Usuario scrollea...                             â”‚
â”‚ âš ï¸  Alert: "Lee todo el contenido"                â”‚
â”‚                                                     â”‚
â”‚ ESTADO 3: LlegÃ³ al final                           â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ â˜‘ï¸  Checkbox del modal: [enabled] âœ…               â”‚
â”‚ âœ…  Alert: "TÃ©rminos aceptados"                    â”‚
â”‚ ğŸŸ¢  BotÃ³n: "Aceptar y continuar" (VERDE)           â”‚
â”‚                                                     â”‚
â”‚ ESTADO 4: AceptÃ³ y volviÃ³ al form                  â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ â˜‘ï¸  Checkbox: [enabled] âœ…                         â”‚
â”‚ âœ…  Mensaje: "TÃ©rminos de protecciÃ³n aceptados"   â”‚
â”‚ ğŸ“„  BotÃ³n: "Ver tÃ©rminos..." (AZUL)                â”‚
â”‚                                                     â”‚
â”‚ ESTADO 5: Usuario marca y envÃ­a                    â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ â˜‘ï¸  Checkbox: [x] MARCADO                          â”‚
â”‚ ğŸ‰  Encuesta lista para enviar                    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Componentes

```
SurveyForm.tsx
    â”œâ”€ Estado: showDataProtectionModal (false/true)
    â”œâ”€ Estado: hasAcceptedDataProtection (false/true)
    â”‚
    â”œâ”€ Etapas 1-5: StandardFormField (normal)
    â”‚
    â”œâ”€ Etapa 6: Renderizado condicional
    â”‚    â”‚
    â”‚    â”œâ”€ Si field.id === "autorizacion_datos"
    â”‚    â”‚    â””â”€> DataProtectionCheckbox
    â”‚    â”‚         â”œâ”€ Props: checked, onCheckedChange, onOpenModal, hasAcceptedTerms
    â”‚    â”‚         â”œâ”€ BotÃ³n link â†’ setShowDataProtectionModal(true)
    â”‚    â”‚         â””â”€ Checkbox disabled={!hasAcceptedDataProtection}
    â”‚    â”‚
    â”‚    â””â”€ Si field.id !== "autorizacion_datos"
    â”‚         â””â”€> StandardFormField (normal)
    â”‚
    â””â”€ Modal: DataProtectionModal
         â”œâ”€ Props: open, onOpenChange, onAccept, isRequired
         â”œâ”€ Estado: hasScrolledToEnd (detectado en handleScroll)
         â”œâ”€ Checkbox bloqueado hasta scroll al final
         â”œâ”€ BotÃ³n "Aceptar..." se habilita cuando:
         â”‚  - hasScrolledToEnd === true
         â”‚  - hasAccepted === true
         â”‚
         â””â”€ onAccept() â†’ setHasAcceptedDataProtection(true)
                        â†’ Modal se cierra
                        â†’ Checkbox del formulario se habilita
```

---

## ğŸ¨ Colores y Estados

```
CHECKBOX INITIAL:
â”Œâ”€ â˜ DISABLED (gris, opacity 60%)
â”‚  â””â”€ No se puede clickear

CHECKBOX HABILITADO:
â”œâ”€ â˜ ENABLED (color normal)
â”‚  â””â”€ Se puede clickear

CHECKBOX MARCADO:
â”œâ”€ â˜‘ MARKED (azul)
â”‚  â””â”€ Listo para enviar


BOTÃ“N LINK:
â”œâ”€ ğŸ“„ Blue Outline (text-blue-600)
â”‚  â”œâ”€ Border: blue-300
â”‚  â””â”€ Hover: bg-blue-50

ALERTAS:
â”œâ”€ âš ï¸ Ãmbar (before scroll)
â”‚  â”œâ”€ Border: amber-200
â”‚  â”œâ”€ Background: amber-50
â”‚  â””â”€ Text: amber-800
â”‚
â””â”€ âœ… Verde (after scroll)
   â”œâ”€ Border: green-200
   â”œâ”€ Background: green-50
   â””â”€ Text: green-800
```

---

## ğŸ“± Responsive Design

```
DESKTOP (1024px+)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Checkbox con texto completo      â”‚
â”‚ ğŸ“„ BotÃ³n link en nueva lÃ­nea        â”‚
â”‚ âš ï¸ Mensaje informativo              â”‚
â”‚                                     â”‚
â”‚ Modal: max-w-2xl (672px)           â”‚
â”‚        max-h-[90vh]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TABLET (768px - 1023px)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Checkbox con texto       â”‚
â”‚ ğŸ“„ BotÃ³n inline            â”‚
â”‚ âš ï¸ Mensaje                 â”‚
â”‚                             â”‚
â”‚ Modal: max-w-2xl (responsive)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MOBILE (< 768px)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Checkbox       â”‚
â”‚ ğŸ“„ BotÃ³n full     â”‚
â”‚ âš ï¸ Mensaje corto  â”‚
â”‚                  â”‚
â”‚ Modal: full width â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ Interactividad

### Click en BotÃ³n "Ver tÃ©rminos..."
```
User Click
    â”‚
    â””â”€> onOpenModal() 
         â””â”€> setShowDataProtectionModal(true)
              â””â”€> Modal aparece con animaciÃ³n fade-in
```

### Scroll en Modal
```
User Scrolls
    â”‚
    â””â”€> handleScroll(e)
         â””â”€> Calcula: scrollHeight - (scrollTop + clientHeight) < 20
              â”œâ”€ Si NO < 20: hasScrolledToEnd = false (âš ï¸ Alert)
              â””â”€ Si < 20: hasScrolledToEnd = true (âœ… Alert + BotÃ³n verde)
```

### Click en "Aceptar y Continuar"
```
User Click (si hasAccepted && hasScrolledToEnd)
    â”‚
    â””â”€> handleAccept()
         â”œâ”€> onAccept() 
         â”‚    â””â”€> setHasAcceptedDataProtection(true)
         â”‚         â””â”€> DataProtectionCheckbox se habilita
         â”‚
         â””â”€> onOpenChange(false)
              â””â”€> Modal cierra
```

### Marcar Checkbox en Formulario
```
User Click Checkbox
    â”‚
    â””â”€> onCheckedChange(true)
         â””â”€> formData.autorizacion_datos = true
              â””â”€> Listo para enviar
```

---

## ğŸš¦ ValidaciÃ³n en EnvÃ­o

```
handleSubmit()
    â”‚
    â”œâ”€ Â¿formData.autorizacion_datos === true?
    â”‚  â”‚
    â”‚  NO â†’ Toast Error: "Debes aceptar..."
    â”‚  â”‚    RETURN (no continÃºa)
    â”‚  â”‚
    â”‚  YES â†’ ContinÃºa
    â”‚         â”‚
    â”‚         â””â”€> transformFormDataToSurveySession()
    â”‚              â””â”€> SurveySubmissionService.submitSurvey()
    â”‚                   â””â”€> API /encuesta
    â”‚                        â””â”€> âœ… Encuesta enviada
```

---

**VersiÃ³n**: 2.0
**Estado**: âœ… COMPLETAMENTE IMPLEMENTADO
**Build**: 7.53 segundos sin errores
**Listo para**: ProducciÃ³n
